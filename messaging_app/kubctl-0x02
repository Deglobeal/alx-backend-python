#!/bin/bash

# Deploy blue version
echo "Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

# Deploy green version
echo "Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

# Check logs for green version
echo "Checking logs for GREEN deployment..."
GREEN_POD=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs $GREEN_POD

# Switch traffic to green
echo "Switching traffic to GREEN..."
kubectl patch service messaging-app-service -p '{"spec":{"selector":{"app":"messaging-app","version":"green"}}}'

echo "Deployment complete. Traffic is now served by GREEN."

